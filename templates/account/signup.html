{% extends "base.html" %}

{% block headtitle %} | Sign Up{% endblock headtitle %}

{% block innercontent %}
<div class="user-action-form-wrap">
    <div class="user-action-form-inner">

		<h1>Sign Up</h1>

		<p>Already have an account? Then please <a href="{{ login_url }}">sign in</a>.</p>

		<form class="signup" id="signup_form" method="post" action="{% url 'account_signup' %}">
			{% csrf_token %}
			{{ form.as_p }}
			{% if redirect_field_value %}
				<input type="hidden" name="{{ redirect_field_name }}" value="{{ redirect_field_value }}" />
			{% endif %}


		{# Newsletter subscription checkbox - NOW ENABLED #}
		<p style="margin-top: 20px;">
			<input type="checkbox" name="subscribe" id="id_subscribe">
			<label for="id_subscribe" style="display: inline; font-weight: normal;">
				Subscribe to the <a href="https://mailer.cinemata.org/" target="_blank" rel="noopener noreferrer">Cinemata newsletter</a> 
				for updates on social justice films from the Asia-Pacific region. 
				Read our <a href="/privacy-policy" target="_blank" rel="noopener noreferrer">privacy policy</a>.
			</label>
		</p>
		
		<button type="submit">Sign Up &raquo;</button>
	</form>
    </div>
</div>

<script>
// Country validation - warn about unusual selections
document.addEventListener('DOMContentLoaded', function() {
    const countrySelect = document.querySelector('select[name="location_country"]');
    if (countrySelect) {
        countrySelect.addEventListener('change', function() {
            // eslint-disable-next-line
            const unusualCountries = {{ UNUSUAL_COUNTRIES_JSON|safe }};
            const selectedValue = this.value;
            const selectedText = this.options[this.selectedIndex].text;
            
            if (unusualCountries.includes(selectedValue)) {
                const confirmed = confirm(
                    'Are you sure you are located in ' + selectedText + '?\n\n' +
                    'Please select your actual location for accurate newsletter delivery and content recommendations.'
                );
                
                if (!confirmed) {
                    this.value = '';
                }
            }
        });
    }
});
</script>
{% endblock innercontent %}

